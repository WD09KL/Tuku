<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>超清壁纸</title>
<link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-color: #111;
    --text-color: #eee;
    --primary-color: #e67e22;
    --secondary-color: #d35400;
    --accent-color: #f39c12;
  }

  body {
    background: var(--bg-color);
    color: var(--text-color);
    font-family: 'Ma Shan Zheng', 'STXingkai', '华文行楷', 'KaiTi', 'STKaiti', '楷体', cursive;
    margin: 0;
    padding: 0;
    transition: background 0.5s ease, color 0.5s ease;
  }

  .wallpaper-card {
    position: relative;
    cursor: pointer;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
  }
  .wallpaper-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
  }
  .wallpaper-card img {
    width: 100%;
    height: 160px;
    display: block;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  .wallpaper-card:hover img {
    transform: scale(1.05);
  }

  .floating-controls {
    position: fixed;
    bottom: 30px;
    right: 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 100;
  }
  
  .theme-toggle {
    width: 100px;
    height: 40px;
    background: #fff;
    border-radius: 30px;
    display: flex;
    align-items: center;
    padding: 0 15px;
    box-sizing: border-box;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  
  .theme-toggle .toggle-ball {
    position: absolute;
    left: 3px;
    top: 3px;
    width: 34px;
    height: 34px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    transition: transform 0.3s cubic-bezier(.4,2.08,.55,.44);
  }
  
  .theme-text {
    position: absolute;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 12px;
    box-sizing: border-box;
    font-size: 14px;
    pointer-events: none;
  }
  
  .theme-text span {
    width: 30px;
    text-align: center;
  }
  
  .theme-text .dark-text {
    color: white;
  }
  
  .theme-text .light-text {
    color: black;
  }
  
  body.light-mode {
    --bg-color: #f5f5f5;
    --text-color: #333;
    background: var(--bg-color);
  }
  
  body.light-mode .theme-toggle .toggle-ball {
    transform: translateX(60px);
  }
  
  .source-toggle {
    width: 100px;
    height: 40px;
    background: #fff;
    border-radius: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 15px;
    box-sizing: border-box;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  
  .source-toggle::after {
    content: '▼';
    margin-left: 5px;
    font-size: 10px;
  }
  
  .source-dropdown {
    position: relative;
  }
  
  .source-dropdown-content {
    display: none;
    position: absolute;
    bottom: 100%;
    right: 0;
    margin-bottom: 10px;
    background-color: var(--bg-color);
    min-width: 120px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 101;
  }
  
  .source-dropdown-content a {
    color: var(--text-color);
    padding: 10px 15px;
    text-decoration: none;
    display: block;
    border-radius: 8px;
  }
  
  .source-dropdown-content a:hover {
    background-color: rgba(255,255,255,0.1);
  }
  
  .source-dropdown-content.show {
    display: block;
  }

  .wallpaper-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 10px;
    padding: 10px 3vw 10px 3vw;
    max-width: 3600px;
    margin: 0 auto;
    box-sizing: border-box;
    align-items: stretch;
  }
</style>
</head>
<body>

<div class="wallpaper-container" id="wallpaperContainer"></div>

<div class="floating-controls">
  <!-- 壁纸源下拉菜单 -->
  <div class="source-dropdown">
    <div class="source-toggle" id="sourceToggle">
      选择壁纸源
    </div>
    <div class="source-dropdown-content" id="sourceDropdown">
      <a href="#" data-type="upx8">超清壁纸</a>
      <a href="#" data-type="thirdparty">Pixabay</a>
      <a href="#" data-type="official">Bing壁纸</a>
      <a href="#" data-type="imgrun-rand">Bing随机</a>
      <a href="https://bing.wdbyte.com/" target="_blank">Bing历史</a>
    </div>
  </div>
  <!-- 主题切换按钮 -->
  <div class="theme-toggle" id="themeToggle">
    <div class="toggle-ball"></div>
    <div class="theme-text">
      <span class="dark-text">黑</span>
      <span class="light-text">白</span>
    </div>
  </div>
</div>

<script>
// 应用状态管理
const state = {
  wallpapers: [],
  currentApi: null,
  isLoading: false,
  isLightMode: localStorage.getItem('themePreference') === 'light',
  page: 1,
  loadingThreshold: 300
};

// DOM元素引用
const elements = {
  wallpaperContainer: document.getElementById('wallpaperContainer'),
  sourceToggle: document.getElementById('sourceToggle'),
  themeToggle: document.getElementById('themeToggle'),
  sourceDropdown: document.getElementById('sourceDropdown'),
  sourceDropdownContent: document.querySelector('.source-dropdown-content')
};

// 初始化主题
function initTheme() {
  document.body.classList.toggle('light-mode', state.isLightMode);
  
  elements.themeToggle.addEventListener('click', () => {
    state.isLightMode = !state.isLightMode;
    document.body.classList.toggle('light-mode', state.isLightMode);
    localStorage.setItem('themePreference', state.isLightMode ? 'light' : 'dark');
  });
}

// 初始化下拉菜单
function initDropdown() {
  elements.sourceToggle.addEventListener('click', (e) => {
    e.stopPropagation();
    elements.sourceDropdownContent.classList.toggle('show');
  });
  
  document.addEventListener('click', () => {
    elements.sourceDropdownContent.classList.remove('show');
  });
  
  elements.sourceDropdownContent.addEventListener('click', (e) => {
    e.stopPropagation();
  });
  
  // 壁纸源选择
  elements.sourceDropdownContent.querySelectorAll('a').forEach(option => {
    option.addEventListener('click', async (e) => {
      e.preventDefault();
      const type = option.dataset.type;
      if (!type) return;
      
      elements.sourceToggle.textContent = option.textContent;
      elements.sourceDropdownContent.classList.remove('show');
      
      state.page = 1;
      state.wallpapers = [];
      elements.wallpaperContainer.innerHTML = '';
      
      await loadWallpapers(16, type);
    });
  });
}

// 加载壁纸
async function loadWallpapers(count = 8, type = null) {
  if (state.isLoading) return;
  
  state.isLoading = true;
  
  try {
    const response = await fetch(`/api/wallpapers?count=${count}${type ? `&type=${type}` : ''}`);
    const data = await response.json();
    
    if (data.success && data.wallpapers) {
      state.wallpapers = [...state.wallpapers, ...data.wallpapers];
      state.currentApi = data.currentApi;
      renderWallpapers(data.wallpapers);
      state.page++;
    }
  } catch (error) {
    console.error('加载壁纸失败:', error);
    alert('加载壁纸失败，请重试');
  } finally {
    state.isLoading = false;
  }
}

// 渲染壁纸
function renderWallpapers(wallpapers) {
  const fragment = document.createDocumentFragment();
  
  wallpapers.forEach(wallpaper => {
    const card = document.createElement('div');
    card.className = 'wallpaper-card';
    
    const img = document.createElement('img');
    img.src = wallpaper.thumb;
    img.alt = wallpaper.title;
    img.loading = 'lazy';
    
    img.onerror = function() {
      this.src = 'data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 width%3D%22200%22 height%3D%22150%22 viewBox%3D%220 0 200 150%22%3E%3Crect fill%3D%22%23333%22 width%3D%22200%22 height%3D%22150%22%2F%3E%3Ctext fill%3D%22%23999%22 font-family%3D%22Arial%22 font-size%3D%2212%22 x%3D%22100%22 y%3D%2275%22 text-anchor%3D%22middle%22%3E图片加载失败%3C%2Ftext%3E%3C%2Fsvg%3E';
    };
    
    card.appendChild(img);
    card.addEventListener('click', () => {
      window.open(wallpaper.full, '_blank');
    });
    
    fragment.appendChild(card);
  });
  
  elements.wallpaperContainer.appendChild(fragment);
}

// 滚动加载
function initScrollLoading() {
  window.addEventListener('scroll', () => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - state.loadingThreshold && !state.isLoading) {
      loadWallpapers();
    }
  });
}

// 初始化应用
async function initApp() {
  initTheme();
  initDropdown();
  initScrollLoading();
  
  // 加载初始壁纸
  await loadWallpapers(16);
}

// 启动应用
document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>    